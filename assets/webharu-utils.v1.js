/*! WebHaru Utils v1 | MIT */(function(g,f){typeof module=='object'&&module.exports?module.exports=f():g.WU=f()})(typeof self!='undefined'?self:this,function(){var d=document,w=typeof window!='undefined'?window:null,q=function(s,c){return(c||d).querySelector(s)},a=function(s,c){return[].slice.call((c||d).querySelectorAll(s))},o=function(t,e,s,h){if(!t)return;if(typeof s=='function'){t.addEventListener(e,s);return}t.addEventListener(e,function(ev){var n=ev.target;while(n&&n!==t){if(n.matches&&n.matches(s)){h.call(n,ev);break}n=n.parentNode}})},b=function(fn,ms){var i;return function(){clearTimeout(i);var a=arguments,c=this;i=setTimeout(function(){fn.apply(c,a)},ms||120)}},hm=function(){if(!w)return{};var r=(w.location.hash||'').replace(/^#/,'');if(!r)return{};var m={};r.split('&').forEach(function(p){if(!p)return;var kv=p.split('=');if(kv.length==2&&kv[0].indexOf('wu:')==0)m[kv[0].slice(3)]=kv[1]});return m},wh=function(o){if(!w)return;var n=hm(),arr=[],k;for(k in n)if(n.hasOwnProperty(k)&&!o.hasOwnProperty(k))arr.push('wu:'+k+'='+n[k]);for(k in o)if(o.hasOwnProperty(k))arr.push('wu:'+k+'='+o[k]);var v=arr.join('&');if(w.history&&w.history.replaceState)w.history.replaceState(null,'',v?'#'+v:w.location.pathname+w.location.search);else w.location.hash=v?'#'+v:''},hashGet=function(id){var m=hm();return m[id]?parseInt(m[id],10)||1:1},hashSet=function(id,val){var o={};o[id]=val;wh(o)},items=function(el){var k=a('.w-dyn-item',el);return k.length?k:[].slice.call(el.children||[])},warn=function(m){if(typeof console!='undefined'&&console.warn)console.warn('[WU]',m)},sel=function(n,s){return'[data-wu="'+n+'"]'+(s||'')},bind=function(name,fn,ctx){a(sel(name),ctx).forEach(function(node){var ds=node.dataset;if(ds.wuBound=='1')return;ds.wuBound='1';fn(node,ds);});},P={},F={},VO=null,SO=null,Links=[],Trim=0,Heads=0;var rp=function(st){var id=st.id,prev='Prev',next='Next';a(sel('pg-controls','[data-wu-for="'+id+'"]')).forEach(function(ctrl){var ds=ctrl.dataset,n=w&&w.innerWidth<480,html='<button type=button class=wu-btn data-wu-page=prev data-wu-for='+id+(st.page==1?' disabled':'')+'>'+(ds.wuLabelPrev||prev)+'</button>';if(n){html+='<span class=wu-info>'+st.page+'/'+st.total+'</span>';}else{var tot=st.total,list=[],i;if(tot<=7){for(i=1;i<=tot;i++)list.push(i);}else{var s=Math.max(1,st.page-2),e=Math.min(tot,st.page+2);list.push(1);if(s>2)list.push(0);for(i=s;i<=e;i++)if(i!=1&&i!=tot)list.push(i);if(e<tot-1)list.push(0);if(tot>1)list.push(tot);}list.forEach(function(num){html+=num?'<button type=button class="wu-btn wu-page'+(num==st.page?' is-active':'')+'" data-wu-page='+num+' data-wu-for='+id+'>'+num+'</button>':'<span class=wu-ellipsis>…</span>';});}html+='<button type=button class=wu-btn data-wu-page=next data-wu-for='+id+(st.page==st.total?' disabled':'')+'>'+(ds.wuLabelNext||next)+'</button>';ctrl.classList.add('wu-controls');ctrl.innerHTML=html;});};var rs=function(st){var vis=st.items.filter(function(it){return it.dataset.wuHidden!='1'});st.total=Math.max(1,Math.ceil(vis.length/st.per));if(st.page>st.total)st.page=st.total;st.items.forEach(function(it){it.style.display='none'});var s=(st.page-1)*st.per,e=s+st.per;vis.forEach(function(it,i){if(i>=s&&i<e)it.style.display='';});rp(st);};var ip=function(){bind('paginate',function(list,ds){var id=list.id;if(!id){warn('paginate id');return}var per=parseInt(ds.wuPer,10)||9,it=items(list),st={id:id,list:list,items:it.slice(),per:per,total:1,page:1,refresh:function(){st.items=items(list);rs(st);}};var saved=hashGet(id);if(saved&&saved<=Math.ceil(it.length/per))st.page=saved;P[id]=st;rs(st);});};var change=function(id,act){var st=P[id];if(!st)return;var n=st.page;if(act=='prev')n=Math.max(1,st.page-1);else if(act=='next')n=Math.min(st.total,st.page+1);else{var num=parseInt(act,10);if(num)n=Math.max(1,Math.min(st.total,num));}if(n==st.page)return;st.page=n;hashSet(id,n);rs(st);};var ipe=function(){o(d,'click',sel('pg-controls')+' button',function(ev){ev.preventDefault();change(this.dataset.wuFor,this.dataset.wuPage);});if(w)w.addEventListener('resize',b(function(){for(var k in P)if(P.hasOwnProperty(k))rp(P[k]);},120));};var ib=function(){bind('breadcrumbs',function(nav,ds){if(!nav.getAttribute('aria-label'))nav.setAttribute('aria-label','Breadcrumb');var home=ds.wuLabelHome||'Home',path=w?w.location.pathname.replace(/\\+/g,'/'):'/',parts=path.split('/').filter(Boolean),html='<ol><li><a href=/>'+home+'</a></li>',acc='';parts.forEach(function(seg,i){acc+='/'+seg;var lbl=decodeURIComponent(seg.replace(/-/g,' '));html+=i==parts.length-1?'<li aria-current=page>'+lbl+'</li>':'<li><a href='+acc+'>'+lbl+'</a></li>';});nav.innerHTML=html+'</ol>';});};var ef=function(sel){if(F[sel])return F[sel];var scope=q(sel);if(!scope){warn('filter scope '+sel);return null}var ent={scope:scope,items:items(scope),buttons:[],pagers:[]};a(sel('paginate'),scope).forEach(function(list){if(list.id)ent.pagers.push(list.id);});F[sel]=ent;return ent;};var af=function(ent){var active=ent.buttons.filter(function(btn){return btn.dataset.wuActive=='1';}).map(function(btn){return btn.dataset.wuKey;});ent.items.forEach(function(it){var tags=(it.dataset.wuTags||'').split(',').map(function(t){return t.trim();}).filter(Boolean),rs=true;if(active.length){for(var i=0;i<active.length;i++)if(tags.indexOf(active[i])==-1){rs=false;break}}if(show){it.dataset.wuHidden='0';it.style.display='';}else{it.dataset.wuHidden='1';it.style.display='none';}});ent.pagers.forEach(function(id){if(P[id])P[id].refresh();});};var ifn=function(){bind('filter',function(btn,ds){var scopeSel=ds.wuScope,key=ds.wuKey;if(!scopeSel||!key){warn('filter data');return}var ent=ef(scopeSel);if(!ent)return;ent.buttons.push(btn);btn.setAttribute('aria-pressed','false');});o(d,'click',sel('filter'),function(ev){ev.preventDefault();var ds=this.dataset,ent=F[ds.wuScope];if(!ent)return;var active=ds.wuActive=='1';if(active){delete ds.wuActive;this.setAttribute('aria-pressed','false');this.classList.remove('is-active');}else{ds.wuActive='1';this.setAttribute('aria-pressed','true');this.classList.add('is-active');}af(ent);});};var is=function(){o(d,'click',sel('sort'),function(ev){ev.preventDefault();var ds=this.dataset,key=ds.wuKey,order=ds.wuOrder||'asc',id=ds.wuFor;if(!key||!id){warn('sort data');return}var list=d.getElementById(id);if(!list){warn('sort list '+id);return}var arr=items(list).sort(function(a,b){var av,bv;if(key=='date'){av=Date.parse(a.dataset.wuDate||'')||0;bv=Date.parse(b.dataset.wuDate||'')||0;}else{av=(a.dataset.wuTitle||'').toLowerCase();bv=(b.dataset.wuTitle||'').toLowerCase();}if(av<bv)return order=='asc'?-1:1;if(av>bv)return order=='asc'?1:-1;return 0;});arr.forEach(function(it){list.appendChild(it);});if(P[id]){P[id].items=items(list);P[id].page=1;P[id].refresh();}});};var il=function(){bind('loadmore',function(list,ds){var id=list.id;if(!id){warn('loadmore id');return}var init=parseInt(ds.wuInitial,10)||9,step=parseInt(ds.wuStep,10)||init,it=items(list);it.forEach(function(el,i){el.style.display=i<init?'':'none';});ds.wuVisible=init;ds.wuStep=step;var btn=q('[data-wu="loadmore-btn"][data-wu-for='+id+']');if(btn&&init>=it.length)btn.disabled=true;});o(d,'click',sel('loadmore-btn'),function(ev){ev.preventDefault();var ds=this.dataset,id=ds.wuFor,list=d.getElementById(id);if(!list)return;var meta=list.dataset,vis=parseInt(meta.wuVisible,10)||0,step=parseInt(meta.wuStep,10)||0,it=items(list),next=vis+step;it.forEach(function(el,i){if(i<next)el.style.display='';});meta.wuVisible=next;if(next>=it.length)this.disabled=true;});};var itc=function(){bind('toc',function(box,ds){var target=q(ds.wuFor);if(!target){warn('toc target');return}var heads=a(ds.wuHeadings||'h2,h3',target);if(!heads.length)return;var list=d.createElement('ul');heads.forEach(function(head){if(!head.id)head.id='wu-heading-'+(++Heads);var li=d.createElement('li');if(head.tagName.toLowerCase()=='h3')li.className='wu-depth-2';var link=d.createElement('a');link.href='#'+head.id;link.textContent=head.textContent.trim();li.appendChild(link);list.appendChild(li);});box.innerHTML='';box.appendChild(list);});};var iex=function(){bind('ext-links',function(scope){var host=w?w.location.hostname:'';scope.querySelectorAll('a[href]').forEach(function(link){var href=link.getAttribute('href');if(!href||href.indexOf('mailto:')==0||href.indexOf('tel:')==0)return;try{var url=new URL(href,w?w.location.href:href);if(url.hostname!=host){link.setAttribute('target','_blank');var rel=(link.getAttribute('rel')||'').split(' ').filter(Boolean);if(rel.indexOf('noopener')==-1)rel.push('noopener');link.setAttribute('rel',rel.join(' '));}}catch(e){}});});};var ig=function(){bind('form-guard',function(node,ds){var form=node.closest('form');if(!form){warn('form guard form');return}var timeout=parseInt(ds.wuTimeout,10)||10000,label=ds.wuLabelSending||'Sending...';if(!form.dataset.wuGuard){form.dataset.wuGuard='1';o(form,'submit',function(){var submit=form.querySelector('[type="submit"]');if(!submit||submit.disabled)return;submit.disabled=true;var origin=submit.dataset.wuOriginalLabel;if(!origin){origin=submit.textContent;submit.dataset.wuOriginalLabel=origin;}submit.textContent=label;setTimeout(function(){submit.disabled=false;submit.textContent=submit.dataset.wuOriginalLabel||origin;},timeout);});}});};var pu=function(){if(!w)return{};var qs=(w.location.search||'').replace(/^\?/,'');if(!qs)return{};var res={};qs.split('&').forEach(function(pair){if(!pair)return;var kv=pair.split('=');if(kv.length==2){var key=decodeURIComponent(kv[0]);if(key.indexOf('utm_')==0)res[key]=decodeURIComponent(kv[1]||'');}});return res;};var iu=function(){var map=pu(),keys=Object.keys(map);if(!keys.length)return;bind('utm',function(scope){keys.forEach(function(name){var input=scope.querySelector('[name="'+name+'"]');if(input&&!input.value)input.value=map[name];});});};var ev=function(){if(VO||typeof IntersectionObserver=='undefined')return VO;VO=new IntersectionObserver(function(entries){entries.forEach(function(entry){var v=entry.target;try{if(entry.isIntersecting){if(v.play)v.play();}else{if(v.pause)v.pause();}}catch(e){}});},{threshold:0.25});return VO;};var iv=function(){if(typeof IntersectionObserver=='undefined')return;ev();bind('video',function(scope){scope.querySelectorAll('video[data-wu-auto]').forEach(function(v){ev().observe(v);});});};var es=function(){if(SO||typeof IntersectionObserver=='undefined')return SO;SO=new IntersectionObserver(function(entries){entries.forEach(function(entry){if(!entry.isIntersecting)return;var id=entry.target.dataset.wuSpy;if(!id)return;Links.forEach(function(link){if(link.dataset.wuLink==id)link.classList.add('is-active');else link.classList.remove('is-active');});});},{threshold:0.5});return SO;};var isp=function(){if(typeof IntersectionObserver=='undefined')return;Links=a('[data-wu="scrollspy"] [data-wu-link]');if(!Links.length)return;es();a('[data-wu-spy]').forEach(function(sec){var ds=sec.dataset;if(ds.wuBound=='1')return;ds.wuBound='1';es().observe(sec);});};var itr=function(){a('[data-wu="trim"] .js-trim').forEach(function(node){var ds=node.dataset;if(ds.wuBound=='1')return;var max=parseInt(ds.wuMax,10);if(!max||max<1)return;var more=ds.wuLabelMore||'続きを読む',full=node.textContent.trim();if(full.length<=max)return;var short=full.slice(0,max),cut=short.lastIndexOf(' ');if(cut>max-20)short=short.slice(0,cut);node.textContent=short+'…';var id='wu-trim-'+(++Trim);ds.wuBound='1';ds.wuTrimId=id;ds.wuFull=full;var btn=d.createElement('button');btn.type='button';btn.className='wu-btn';btn.dataset.wuTrimTrigger=id;btn.textContent=more;if(node.parentNode)node.parentNode.insertBefore(btn,node.nextSibling);});};on(d,'click','[data-wu-trim-trigger]',function(ev){ev.preventDefault();var ds=this.dataset,id=ds.wuTrimTrigger,target=q('[data-wu-trim-id='+id+']');if(!target)return;target.textContent=target.dataset.wuFull||target.textContent;delete target.dataset.wuFull;if(this.parentNode)this.parentNode.removeChild(this);});var initAll=function(){ip();ipe();ib();ifn();is();il();itc();iex();ig();iu();iv();isp();itr();};if(d.readyState=='loading')d.addEventListener('DOMContentLoaded',initAll);else setTimeout(initAll,0);return{init:initAll,pagination:P,utils:{$:q,$$:a,on:o,debounce:b,hashGet:hashGet,hashSet:hashSet}};});